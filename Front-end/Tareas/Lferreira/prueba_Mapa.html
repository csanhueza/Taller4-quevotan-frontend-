<!DOCTYPE html>
<html>
<head>
	<title> Mapa</title>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="js/fisheye.js" type="text/javascript"></script>	
</head>
<style type="text/css">
	svg {
		border: 1px solid black;
	}
.axis path,
.axis line {
    fill: none;
    stroke: black;
    shape-rendering: crispEdges;
        }

.axis text {
    font-family: sans-serif;
    font-size: 11px;
}

</style>
<body>
 <section>
 </section>

<script>
d3.json("json/data.json",function(error,json){
	if(error)
	{	
		return console.warn(error);
	}
	renderData(json);
});
// Funcion que crea Grafico
function renderData(data){	
	
	// Obtencion de Datos
	var json = data;
	var coord = get_coord(data);
	var nombres = get_nombres(data);
	var partido = get_partido(data);
	var padding = 30;
	// Creacion de Grafico
	var w = 800; var h = 600;

	// Escalas de Ejes
    var xScale = d3.scale.linear()
    	.domain([d3.min(coord,function(d){ return d[0]}),d3.max(coord,function(d){ return d[0]})])
    	.range([padding,w-padding]);
    var yScale = d3.scale.linear()
    	.domain([d3.min(coord,function(d){ return d[1]}),d3.max(coord,function(d){ return d[1]})])
    	.range([h-padding,padding]);
    //---------------------------------
    var svg = d3.select("section")
    		.append("svg")
    		.attr("width",w)
    		.attr("height",h);
    svg.selectAll("circle")
       .data(coord)
       .enter()
       .append("circle")
       .style("fill",function(d,i){
       		return return_Color(data,i);
       })
       .attr("cx",function(d,i){
			return xScale(d[0]);
       })
       .attr("cy",function(d,i){
       	    return yScale(d[1]);
       })
       .on("mouseenter", function(d,i){
       		seleccionTexto
            .attr('x',xScale(coord[i][0]))
            .attr('y',yScale(coord[i][1])-5)
            .style('opacity',1)
            .text(nombres[i]);
		})
	   .on("mouseout", function(d){
      		seleccionTexto
      			.attr('r',0)
      			.style('opacity',0);
        })
       .attr("r",5);
    // AÃ±adir Ejes
    var xAxis = d3.svg.axis()
    	.scale(xScale)
    	.orient("bottom");

    var yAxis = d3.svg.axis()
    	.scale(yScale)
    	.orient("left")
    	.ticks(10);

    svg.append("g")
       .attr("class","axis")
       .attr("transform","translate(0,"+(h-padding)+")")
       .call(xAxis);
    svg.append("g")
       .attr("class","axis")
       .attr("transform","translate("+(padding)+",0)")
       .call(yAxis);
    var legend = svg.selectAll(".legend")
        .data(partido)
        .enter().append("g")
        .attr("class","legend")
        .attr("transform", function(d,i) { return "translate("+(w+20)+"," + i * 22 + ")"; });
    var seleccionTexto = svg.append('text')
	   .attr("class", "seleccionTexto")
	   .attr('x',0)
	   .attr('y',0)
	   .attr('text-anchor',"middle")
	   .text('ejemplo de texto');
}
function get_coord(data){
	var coord = new Array(data.Legislatura.length);
	for(var i=0 ; i < data.Legislatura.length;i++){
		coord[i] = [parseFloat(data.Legislatura[i].x),parseFloat(data.Legislatura[i].y)];
	}
	return coord;
}
function get_nombres(data){
	var name = new Array(data.Legislatura.length);
	for (var i=0;i<name.length;i++){
		name[i] = data.Legislatura[i].Nombre;
	}
	return name;
}
function return_Color(data,pos){
	switch (data.Legislatura[pos].Partido)
	{
		case "PEV":
			return "#FF5733";
		case "PH":
			return "red";
		case "LIBERAL":
		    return "blue";
		case "PODER":
			return "black";
		case "PPD":
			return "yellow";
		case "PRO":
		    return "brown";
		case "PRSD":
			return "violet";
		case "PS":
			return "green";
		case "EVOP":
			return "aqua";
		case "RN":
			 return "orange";
		case "PC":
			 return "olive";
		case "FRVS":
			 return "maroon";
		case "UDI" :
		     return "red";
		case "DC":
			 return "lime";
		case "IND":
			 return "Silver";
		case "RD":
			 return "Gray";
	} }
function get_partido(data){
	var partido = [[ "PEV", "#FF5733"],[ "PH", "red"],[ "LIBERAL", "blue"],
				   [ "PODER", "black"],[ "PPD", "yellow"],[ "PRO", "brown"],
				   [ "PRSD", "violet"],[ "PS", "green"],[ "EVOP", "aqua"],
                   [ "RN", "orange"],[ "PC", "olive"],[ "FRVS", "maroon"],
				   [ "UDI" , "red"],[ "DC", "lime"],[ "IND", "Silver"],[ "RD", "Gray"]]
	return partido;
}

</script>
</body>
</html>